name: üöÄ Deploy a servidor FTP/SFTP

on:
  push:
    branches:
      - master  # Cambia si tu rama principal es otra

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Descargar c√≥digo
      - name: Checkout code
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Subir archivos al servidor por FTP/SFTP
      - name: Upload to server via FTPS (TLS)
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          port: ${{ secrets.FTP_PORT }}
          protocol: ftps         # Usa TLS (FTPS). Si tu servidor es SFTP, usa protocol: sftp
          local-dir: ./           # Carpeta local a subir
          server-dir: ./   # Ruta remota en tu hosting
          exclude: |              # Archivos/carpetas a ignorar
            **/.git*
            **/.github*
            **/node_modules/**
            **/vendor/**
            **/.env
            **/storage/logs/**
            **/storage/framework/cache/**
            **/storage/framework/views/*

      # 3Ô∏è‚É£ Llamar a script PHP en el servidor para tareas post-deploy
      - name: Post-deploy script
        run: |
          curl -X GET "https://farmacia.armada.mil.do/artisan-run.php?cmd=migrate:fresh%20--seed"
